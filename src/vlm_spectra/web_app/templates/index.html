<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Computer Vision Interpretability Demo</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <div class="col-12">
                <h1 class="text-center my-4">Computer Vision Interpretability Demo</h1>
                <p class="text-center text-muted">Interactive demo for UI-TARS model inference on uploaded images</p>
            </div>
        </div>
        
        <!-- Model Status -->
        <div class="row mb-4">
            <div class="col-12">
                <div id="modelStatus" class="alert alert-info">
                    <i class="spinner-border spinner-border-sm me-2" role="status"></i>
                    <span>Model loading...</span>
                </div>
            </div>
        </div>
        
        <div class="row">
            <!-- Controls Panel -->
            <div class="col-md-4">
                <div class="card">
                    <div class="card-header">
                        <h5>Image Upload & Controls</h5>
                    </div>
                    <div class="card-body">
                        <form id="demoForm">
                            <!-- Image Upload -->
                            <div class="mb-3">
                                <label for="imageUpload" class="form-label">Upload Image</label>
                                <div class="drop-zone" id="dropZone">
                                    <div class="drop-zone-content">
                                        <i class="fas fa-cloud-upload-alt fa-2x mb-2"></i>
                                        <p class="mb-2">Drag & drop your image here</p>
                                        <p class="text-muted small">or click to browse, or paste from clipboard</p>
                                        <input type="file" id="imageUpload" name="image" accept=".png,.jpg,.jpeg,.gif,.bmp,.webp" class="d-none">
                                    </div>
                                </div>
                                <div class="form-text">
                                    Supported formats: PNG, JPG, JPEG, GIF, BMP, WebP (max 16MB)<br>
                                    <small class="text-info"><i class="fas fa-info-circle"></i> Tip: You can also paste images directly with Ctrl+V (Cmd+V on Mac)</small>
                                </div>
                            </div>
                            
                            <!-- Image Preview -->
                            <div class="mb-3 d-none" id="imagePreviewContainer">
                                <label class="form-label">Preview</label>
                                <div class="text-center">
                                    <img id="imagePreview" src="" alt="Preview" class="img-thumbnail" style="max-height: 200px;">
                                    <div class="mt-2">
                                        <button type="button" class="btn btn-sm btn-outline-secondary" id="removeImage">Remove Image</button>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Task -->
                            <div class="mb-3">
                                <label for="task" class="form-label">Task</label>
                                <input type="text" class="form-control" id="task" name="task" value="Click on the red square.">
                                <div class="form-text">The instruction given to the model</div>
                            </div>
                            
                            <button type="submit" class="btn btn-primary w-100" id="predictBtn" disabled>
                                <span class="spinner-border spinner-border-sm me-2 d-none" id="predictSpinner"></span>
                                Analyze Image
                            </button>
                        </form>
                    </div>
                </div>
            </div>
            
            <!-- Results Panel -->
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header">
                        <h5>Results</h5>
                    </div>
                    <div class="card-body" id="resultsContainer">
                        <div class="text-center text-muted py-5">
                            <i class="fas fa-image fa-3x mb-3"></i>
                            <p>Upload an image and click "Analyze Image" to see results</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Results Template (hidden) -->
    <div id="resultsTemplate" class="d-none">
        <div class="row">
            <div class="col-md-6">
                <h6>Uploaded Image</h6>
                <div class="position-relative">
                    <img id="resultImage" src="" alt="Uploaded image" class="img-fluid border">
                    <canvas id="overlayCanvas" class="position-absolute top-0 start-0"></canvas>
                </div>
                <div class="mt-2">
                    <small class="text-muted">
                        Size: <span id="imageSize"></span>
                    </small>
                </div>
            </div>
            <div class="col-md-6">
                <h6>Model Output</h6>
                <div class="bg-light p-3 rounded mb-3" style="max-height: 200px; overflow-y: auto;">
                    <pre id="modelOutput" class="mb-0 small"></pre>
                </div>
                
                <h6>Prediction Results</h6>
                <table class="table table-sm">
                    <tr>
                        <th>Task:</th>
                        <td id="taskText"></td>
                    </tr>
                    <tr>
                        <th>Prediction:</th>
                        <td id="prediction"></td>
                    </tr>
                    <tr>
                        <th>Accuracy:</th>
                        <td>
                            <span id="accuracyBadge"></span>
                            <span id="distance" class="small text-muted"></span>
                        </td>
                    </tr>
                    <tr>
                        <th>Inference Time:</th>
                        <td id="inferenceTime"></td>
                    </tr>
                </table>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>